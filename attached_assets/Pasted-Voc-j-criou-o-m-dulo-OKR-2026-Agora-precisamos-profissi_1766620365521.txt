VocÃª jÃ¡ criou o mÃ³dulo OKR 2026. Agora precisamos â€œprofissionalizarâ€:
- ampliar mÃ©tricas (inadimplÃªncia, churn, net churn, logo churn, receita e divisÃ£o, vendas novas vs monetizaÃ§Ã£o base, TurboOH)
- melhorar KRs (menos redundÃ¢ncia, mais alinhadas ao plano Bigger & Better: ConsolidaÃ§Ã£o, Escala e PadronizaÃ§Ã£o + eficiÃªncia + melhoria de produto/sistemas)
- enriquecer iniciativas (Hugz, sistemas internos, eficiÃªncia operacional, TurboOH, padronizaÃ§Ã£o)
- manter read-only: NÃƒO criar tabelas no banco, NÃƒO usar supabase, NÃƒO persistir iniciativas no DB. Pode manter JSON seed read-only.

ğŸ¯ Nome interno do plano 2026:
â€œBigger & Better â€” ConsolidaÃ§Ã£o, Escala e PadronizaÃ§Ã£oâ€

========================
1) PRINCÃPIOS / RESTRIÃ‡Ã•ES
========================
- Somente leitura do Google Cloud SQL usando o pool/driver atual (pg.Pool + drizzle/db.execute).
- NÃ£o criar tabelas, nÃ£o migrar schema, nÃ£o gravar dados.
- O mÃ³dulo OKR 2026 deve ser +1 item no menu lateral e ter 1 tela com 2â€“3 abas:
  (a) Dashboard
  (b) KRs
  (c) Iniciativas
- NÃ£o destrinchar por produto/serviÃ§o. Apenas macro + BU (TurboOH) + Tech Projects como KPI de margem/eficiÃªncia.

========================
2) PADRONIZAR â€œREGISTRYâ€ (config-driven)
========================
Crie/ajuste:
server/okr/okrRegistry.ts
- export const metricRegistry = { key: {label, unit, format, cadence, seriesQueryFn, latestQueryFn, notes} }
- export const krRegistry = [ { id, objectiveId, title, metricKey, operator, cadence, targetType, targets, description } ]
- export const objectiveRegistry = [ { id, title, ownerRole, narrative } ]

O frontend deve consumir /api/okr/summary que retorna:
{
  objectives: [...],
  krs: [...],              // com currentValue e status
  highlights: {...},        // cards principais
  series: {...}             // sÃ©ries para grÃ¡ficos
}

========================
3) MÃ‰TRICAS QUE DEVEM EXISTIR (MVP completo)
========================
Implementar no metricsAdapter.ts (ou refatorar para okrRegistry + adapter):
Reaproveitar tabelas jÃ¡ existentes no Cortex:
- cup_data_hist, cup_contratos, (cup_clientes se existir)
- caz_parcelas (+ categorias), caz_receber, rh_pessoal

3.1 Receita e composiÃ§Ã£o
- MRR_Ativo (mensal, snapshot)
- Receita_Pontual (mensal)
- Outras_Receitas (mensal)
- Receita_Total_Faturavel (mensal) = MRR + Pontual + Outras (ou via DFC se preferir)
- Receita_Liquida (mensal) = Receita Total - Impostos
- CSV (mensal)
- Lucro_Bruto (mensal)
- SG&A (mensal)
- CAC (mensal)
- EBITDA (mensal)
- Geracao_Caixa (mensal)
- Saldo_Caixa (mensal, se tiver no DB; se nÃ£o, calcular acumulado de geraÃ§Ã£o)

3.2 Vendas (novas vs monetizaÃ§Ã£o base)
- New_MRR (mensal) = contratos iniciados no mÃªs (somente novos clientes se possÃ­vel; senÃ£o, novos contratos)
- Expansion_MRR (mensal) = aumento de valorr em base (diff snapshots) â€” se for pesado, usar aproximaÃ§Ã£o por comparaÃ§Ã£o mÃªs a mÃªs no cup_data_hist.
- Base_Monetization_MRR (mensal) = Expansion_MRR (nome no dashboard â€œMonetizaÃ§Ã£o da Baseâ€)
- Vendas_Pontual (mensal) = valor_p contratos iniciados no mÃªs

3.3 RetenÃ§Ã£o / churn
- Gross_MRR_Churn (mensal) = somatÃ³rio valorr cancelado no mÃªs
- Gross_MRR_Churn_% (mensal) = gross_churn / MRR_inicio_mes
- Net_MRR_Churn (mensal) = Gross - Expansion
- Net_MRR_Churn_% (mensal) = net_churn / MRR_inicio_mes
- Logo_Churn (mensal) = #clientes cancelados no mÃªs
- Logo_Churn_% (mensal) = clientes_cancelados / clientes_inicio_mes
Obs: se cup_clientes nÃ£o existir, calcular logo churn via cup_contratos agrupado por cliente_id (cliente considerado â€œcanceladoâ€ se nÃ£o tiver contratos ativos apÃ³s o mÃªs).

3.4 InadimplÃªncia
- Inadimplencia_Valor (mensal) = total vencido em atraso (caz_receber)
- Inadimplencia_% (mensal) = vencido / receita_faturavel (ou vencido / receita_liquida, escolha 1 e documente)

3.5 EficiÃªncia operacional
- Headcount_Total (mensal) = rh_pessoal ativos
- Headcount_CSV / CAC / SGA (mensal) se existirem no RH; se nÃ£o, usar a divisÃ£o jÃ¡ existente no BI do Cortex.
- Receita_por_Cabeca = Receita_Total / Headcount
- MRR_por_Cabeca = MRR / Headcount
- SGA_% = SG&A / Receita_Liquida
- CAC_% = CAC / Receita_Liquida

3.6 TurboOH (BU evidenciada)
- Receita_OH (mensal) = filtro por categorias/clientes TurboOH (usar a mesma regra jÃ¡ existente no Cortex; se nÃ£o tiver, criar mapping em server/okr/ohMapping.ts com lista de categorias/keywords)
- Resultado_OH (mensal) = Receita_OH - Custos_OH (mesma regra de mapping)
- Margem_OH_% (mensal)

3.7 Tech Projects (macro, sem â€œprodutoâ€)
- Valor_Projetos_Tech (mensal) = valor projetos entregues tech
- Custo_Freelancers_Tech (mensal)
- Pct_Freelancers_Tech = custo_freelancers / valor_projetos

========================
4) KRs 2026 (reais, nÃ£o redundantes)
========================
Atualize e consolide KRs para refletir:
- escala do ecossistema (company + BU)
- eficiÃªncia e caixa (sistemas e disciplina)
- retenÃ§Ã£o / risco (inadimplÃªncia e churn)
- padronizaÃ§Ã£o + melhoria de produto/sistemas (como iniciativa medida por proxy operacional)

Defina targets usando os valores do BP informado:

O1 â€” Escala do Ecossistema (Company)
KR1 (MRR Quarter-End):
- Mar: 1_338_869.55
- Jun: 1_611_315.266
- Sep: 1_871_384.456
- Dez: 2_122_127.056

KR2 (Receita LÃ­quida Anual, soma mensal): 20_055_090.582

KR3 (Clientes Ativos em Dez): 511

KR4 (Mix de Receita Recorrente saudÃ¡vel):
- % Receita Recorrente sobre Receita Total >= 80% (calcular mensal e mostrar mÃ©dia trimestral)

O2 â€” EficiÃªncia e Caixa (Company)
KR1 (EBITDA Anual, soma mensal): 5_269_767.578

KR2 (GeraÃ§Ã£o de Caixa Anual, soma mensal): 3_088_046.602

KR3 (Saldo de Caixa em Dez): 3_738_046.602

KR4 (SG&A % teto): <= 21% (mÃ©dia trimestral, usando SG&A/Receita LÃ­quida)

KR5 (CAC % teto): <= 23% (mÃ©dia trimestral, usando CAC/Receita LÃ­quida)

O3 â€” RetenÃ§Ã£o e Risco (Company)
KR1 (InadimplÃªncia %): <= 6.0% (mÃ©dia trimestral; com alerta semanal se passar)

KR2 (Net MRR Churn %): <= 9.0% (mÃ©dia trimestral)

KR3 (Logo Churn %): <= 10.0% (mÃ©dia trimestral)

O4 â€” BU Evidenciada (TurboOH)
KR1 (Receita OH anual): >= 1_425_600
KR2 (Resultado OH anual): >= 989_700
Obs: se o cÃ¡lculo OH no DB ainda nÃ£o bater esses nÃºmeros, manter esses targets como â€œOKR Targetâ€ e exibir tambÃ©m â€œValor Medido (DB)â€ com flag â€œMapping em ajusteâ€.

O5 â€” Sistemas internos e produto (proxy tÃ©cnico, sem inventar mÃ©trica)
Sem criar novas tabelas. Medir com proxies que jÃ¡ temos:
KR1 (Pct Freelancers Tech): <= 8% (mÃ©dia trimestral)
KR2 (MRR/Headcount em Dez): >= 11_700 (aprox BP: 11_790) â€” use o target 11_790

========================
5) INICIATIVAS (seed read-only, mais robusto)
========================
Atualize server/okr/initiatives.json com 15â€“20 iniciativas com estrutura:
{
  id, objectiveId, name, ownerRole, start, end, status,
  krsImpacted: [krIds],
  successMetricKeys: [metricKeys],
  notes
}

SugestÃ£o mÃ­nima de iniciativas (inclua todas):
- Hugz: CobranÃ§a & RetenÃ§Ã£o (inadimplÃªncia, churn, net churn, logo churn)
- PadronizaÃ§Ã£o de operaÃ§Ã£o por BU (SOPs, QBR, templates)
- Produto: pacotes â€œTurboCommerceâ€ (sem detalhar produto, sÃ³ â€œpacotes e padrÃ£o de entregaâ€)
- Data Coverage: padronizar categorias DFC (SG&A, CAC, CSV) para confiabilidade do BI
- Regras de upsell/expansÃ£o (monetizaÃ§Ã£o base) + playbook
- Qualidade de entrega: health score de clientes (proxy via churn/expansÃ£o)
- TurboOH: mapeamento confiÃ¡vel no DB (categorias/cliente) + margem
- TurboOH: playbook comercial e oferta (sem detalhar inventÃ¡rio)
- EficiÃªncia: revisÃ£o de alocaÃ§Ã£o headcount CSV/CAC/SGA (se jÃ¡ existir no RH)
- Tech: pipeline e SLA de projetos (projeto entregue vs custo freelancers)
- GovernanÃ§a: Monthly OKR Review com decision log
- AutomaÃ§Ã£o: alertas semanais (inadimplÃªncia>teto, net churn>teto, SG&A%>teto, CAC%>teto)

========================
6) UI/UX (melhorias pragmÃ¡ticas)
========================
Na aba Dashboard:
- Cards: MRR, Receita LÃ­quida, EBITDA, Caixa, InadimplÃªncia %, Net Churn %, Logo Churn %
- Bloco TurboOH destacado: Receita OH, Resultado OH, Margem OH
- Bloco Vendas: New MRR vs MonetizaÃ§Ã£o Base (Expansion)
- GrÃ¡ficos: MRR (linha), EBITDA (barra), InadimplÃªncia% (linha), Churn% (linha)

Na aba KRs:
- Tabela com status automÃ¡tico:
  Verde: >=100% target (ou <= teto)
  Amarelo: 90â€“99% (ou atÃ© +10% do teto)
  Vermelho: <90% (ou > teto +10%)
- Filtro por Objective e por Cadence (Quarter / Annual)

Na aba Iniciativas:
- Lista com chips de status + objetivo
- Mostrar quais KRs impacta e qual mÃ©trica confirma

========================
7) NÃƒO QUEBRAR O CORTEX
========================
- Reutilizar queries existentes sempre que possÃ­vel.
- Cache simples em memÃ³ria por 5 minutos para endpoints /api/okr/*
- Tratar ausÃªncia de tabela/campo: retornar â€œN/Aâ€ com reason e criar fallback.

EntregÃ¡veis:
- Endpoint consolidado /api/okr/summary
- Registry (okrRegistry.ts) com mÃ©tricas + KRs + objetivos
- Iniciativas seed ampliadas
- UI refinada (3 abas) consumindo summary
- Zero escrita no banco